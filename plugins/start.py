from asyncio import sleep
from pyrogram import Client, filters
from pyrogram.types import InlineKeyboardButton, InlineKeyboardMarkup, ForceReply, CallbackQuery
# from pyrogram.errors import FloodWait
# import humanize
# import random
from helpo.txt import mr
from helpo.database import db
from config import *
from plugins.LazyDev_F_Sub import lazy_force_sub, is_subscribed

@Client.on_message(filters.private & filters.command(["start"]))
async def start(client, message):
    user = message.from_user
    if not await db.is_user_exist(user.id):
        await db.add_user(user.id)

    if (FORCE_SUB_CHANNEL or FORCE_SUB_CHANNEL2 or FORCE_SUB_CHANNEL3) and not await is_subscribed(client, message):
        # User is not subscribed to any of the required channels, trigger force_sub logic
        return await lazy_force_sub(client, message) 
              
    welcome_text = """
    ğŸ‘‹ Hey {}! Welcome to the *LazyBot* ğŸ¤–âœ¨

    I'm here to make your life easier and fun! Here's what I can do for you:

    1ï¸âƒ£ *Instagram* â€“ Download Stories, Reels, and Posts from Instagram.
    2ï¸âƒ£ *TikTok* â€“ Get videos without watermark.
    3ï¸âƒ£ *Twitter* â€“ Download media from tweets.
    4ï¸âƒ£ *Pinterest* â€“ Grab images and posts from Pinterest.
    5ï¸âƒ£ Plus, much more... ğŸš€

    Simply send me the *URL* of the media you want to download, and I'll take care of the rest! ğŸ‰

    Let's start downloading your favorite content! ğŸš€
    """

    button=InlineKeyboardMarkup([[
        InlineKeyboardButton('ğŸ“¢ ğš„ğ™¿ğ™³ğ™°ğšƒğ™´ğš‚', url='https://t.me/lazydeveloper'),
        InlineKeyboardButton('â™» ğš‚ğš„ğ™¿ğ™¿ğ™¾ğšğšƒ', url='https://t.me/lazydeveloper')
        ],[
        InlineKeyboardButton("â¤.[-. ğ™³ğ™´ğš…ğš‚ .-].ğŸŸ", callback_data='dev')
        ][
        InlineKeyboardButton('ğŸ¦‹ ğ™°ğ™±ğ™¾ğš„ğšƒ', callback_data='about'),
        InlineKeyboardButton('â„¹ï¸ ğ™·ğ™´ğ™»ğ™¿', callback_data='help')
        ]])
    if START_PIC:
        await message.reply_photo(START_PIC, caption=welcome_text.format(message.from_user.mention), reply_markup=button)       
    else:
        await message.reply_text(text=welcome_text.format(message.from_user.mention), reply_markup=button, disable_web_page_preview=True)
   

@Client.on_callback_query()
async def cb_handler(client, query: CallbackQuery):
    data = query.data 
    if data == "start":
        await query.message.edit_text(
            text=f"""ğŸ‘‹ Hai {query.from_user.mention} \nğ™¸'ğš– ğ™° ğš‚ğš’ğš–ğš™ğš•ğš ğ™µğš’ğš•ğš ğšğšğš—ğšŠğš–ğš+ğ™µğš’ğš•ğš ğšƒğš˜ ğš…ğš’ğšğšğš˜ ğ™²ğš˜ğšŸğšğš›ğšğšğš› ğ™±ğ™¾ğšƒ ğš†ğš’ğšğš‘ ğ™¿ğšğš›ğš–ğšŠğš—ğšğš—ğš ğšƒğš‘ğšğš–ğš‹ğš—ğšŠğš’ğš• & ğ™²ğšğšœğšğš˜ğš– ğ™²ğšŠğš™ğšğš’ğš˜ğš— ğš‚ğšğš™ğš™ğš˜ğš›ğš! """,
            reply_markup=InlineKeyboardMarkup( [[
                InlineKeyboardButton("ğŸ‘¼ ğ™³ğ™´ğš…ğš‚ ğŸ‘¼", callback_data='dev')                
                ],[
                InlineKeyboardButton('ğŸ“¢ ğš„ğ™¿ğ™³ğ™°ğšƒğ™´ğš‚', url='https://t.me/'),
                InlineKeyboardButton('ğŸ‚ ğš‚ğš„ğ™¿ğ™¿ğ™¾ğšğšƒ', url='https://t.me/')
                ],[
                InlineKeyboardButton('ğŸƒ ğ™°ğ™±ğ™¾ğš„ğšƒ', callback_data='about'),
                InlineKeyboardButton('â„¹ï¸ ğ™·ğ™´ğ™»ğ™¿', callback_data='help')
                ]]
                )
            )
    elif data == "help":
        await query.message.edit_text(
            text=mr.HELP_TXT,
            reply_markup=InlineKeyboardMarkup( [[
               #âš ï¸ don't change source code & source link âš ï¸ #
               InlineKeyboardButton("â£ï¸ ğš‚ğ™¾ğš„ğšğ™²ğ™´", url="https://github.com/")
               ],[
               InlineKeyboardButton("â¤ï¸â€ğŸ”¥ ğ™·ğ™¾ğš† ğšƒğ™¾ ğš„ğš‚ğ™´  â¤ï¸â€ğŸ”¥", url='https://youtu.be/')
               ],[
               InlineKeyboardButton("ğŸ”’ ğ™²ğ™»ğ™¾ğš‚ğ™´", callback_data = "close"),
               InlineKeyboardButton("â—€ï¸ ğ™±ğ™°ğ™²ğ™º", callback_data = "start")
               ]]
            )
        )
    elif data == "about":
        await query.message.edit_text(
            text=mr.ABOUT_TXT.format(client.mention),
            disable_web_page_preview = True,
            reply_markup=InlineKeyboardMarkup( [[
               #âš ï¸ don't change source code & source link âš ï¸ #
               InlineKeyboardButton("â£ï¸ ğš‚ğ™¾ğš„ğšğ™²ğ™´", url="https://github.com/")
               ],[
               InlineKeyboardButton("ğŸ–¥ï¸ ğ™·ğ™¾ğš† ğšƒğ™¾ ğ™¼ğ™°ğ™ºğ™´", url="https://youtu.be/")
               ],[
               InlineKeyboardButton("ğŸ”’ ğ™²ğ™»ğ™¾ğš‚ğ™´", callback_data = "close"),
               InlineKeyboardButton("â—€ï¸ ğ™±ğ™°ğ™²ğ™º", callback_data = "start")
               ]]
            )
        )
    elif data == "dev":
        await query.message.edit_text(
            text=mr.DEV_TXT,
            reply_markup=InlineKeyboardMarkup( [[
               #âš ï¸ don't change source code & source link âš ï¸ #
               InlineKeyboardButton("â£ï¸ ğš‚ğ™¾ğš„ğšğ™²ğ™´", url="https://github.com/")
               ],[
               InlineKeyboardButton("ğŸ–¥ï¸ ğ™·ğ™¾ğš† ğšƒğ™¾ ğ™¼ğ™°ğ™ºğ™´", url="https://youtu.be/")
               ],[
               InlineKeyboardButton("ğŸ”’ ğ™²ğ™»ğ™¾ğš‚ğ™´", callback_data = "close"),
               InlineKeyboardButton("â—€ï¸ ğ™±ğ™°ğ™²ğ™º", callback_data = "start")
               ]]
            )
        )
    elif data == "close":
        try:
            await query.message.delete()
            await query.message.reply_to_message.delete()
        except:
            await query.message.delete()





